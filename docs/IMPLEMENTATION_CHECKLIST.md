# 구현 체크리스트 (DoD 기반)

> `project_outline.md`를 기반으로 한 구현 체크리스트입니다.
> 각 항목은 완료 기준(Definition of Done)에 따라 검증됩니다.
>
> **범례**: ✅ 완료 | ⚠️ 부분 완료 | ❌ 미완료

---

## Phase 1: 프로젝트 초기화 및 인프라

### 1.1 프로젝트 설정
- [x] Next.js (App Router) + TypeScript 프로젝트 생성
- [x] ESLint + Prettier 설정
- [x] 타입체크 스크립트 추가
- [x] `.env.example` 작성 (모든 환경변수 키 목록)
- [x] `README.md` 작성 (로컬 실행 방법, 환경변수, Supabase 설정)

### 1.2 Supabase 스키마/마이그레이션
- [x] `users` 테이블 (id, email, role, status, created_at)
  - role: PUBLIC, USER_PENDING, CONSULTANT_APPROVED, OPS_ADMIN, SYSTEM_ADMIN
  - status: ACTIVE, SUSPENDED
- [x] `consultant_profiles` 테이블 (매칭용 프로필)
  - 정형: 전문분야[], 가능업종[], 강의레벨[], 코칭방식[], 역량태그[]
  - 서술: 대표경험, 포트폴리오, 강점/제약
- [x] `projects` 테이블 (기업 요청)
  - status: NEW → DIAGNOSED → MATCH_RECOMMENDED → ASSIGNED → INTERVIEWED → ROADMAP_DRAFTED → FINALIZED
- [x] `self_assessments` 테이블 (자가진단 30문항)
- [x] `matching_recommendations` 테이블 (매칭 추천 결과)
- [x] `project_assignments` 테이블 (배정 이력 + 사유)
- [x] `interviews` 테이블 (현장 인터뷰)
- [x] `roadmap_versions` 테이블 (버전관리)
- [x] `audit_logs` 테이블 (감사로그)
- [x] `usage_metrics` 테이블 (사용량/쿼터)
- [x] `self_assessment_templates` 테이블 (자가진단 템플릿)
- [x] 인덱스 생성 (검색/정렬 최적화)

### 1.3 RLS 정책
- [x] 사용자는 본인 데이터만 조회/수정 가능
- [x] 컨설턴트는 배정된 프로젝트만 접근 가능
- [x] OPS_ADMIN은 모든 프로젝트 조회/관리 가능
- [x] 자가진단 입력/수정은 OPS_ADMIN만 가능
- [x] 로드맵 FINAL 확정은 배정된 컨설턴트만 가능 (OPS는 읽기 전용)

---

## Phase 2: 인증/승인 플로우 ✅ 완료

### 2.1 회원가입/로그인
- [x] 이메일+비밀번호 회원가입 (Supabase Auth)
- [x] 가입 시 기본 상태: USER_PENDING
- [x] 개인정보 수집·이용 동의 체크박스

### 2.2 컨설턴트 프로필 등록 (회원가입 단계)
- [x] 정형 입력: 전문분야(복수), 가능업종(복수), 강의레벨, 코칭방식, 역량태그
- [x] 서술 입력: 대표 수행경험, 포트폴리오, 강점/제약
- [x] 필수 입력 검증 (zod 스키마)
- [x] 프로필 미입력 시 가입 불가

### 2.3 승인 프로세스
- [x] USER_PENDING 사용자는 핵심 기능 차단
- [x] 차단 시 안내 문구 표시 ("승인 대기 중입니다...")
- [x] OPS_ADMIN이 사용자 승인 → CONSULTANT_APPROVED 승격
- [x] 승인/정지 기능 (OPS_ADMIN만)
- [x] 승인/정지 이벤트 감사로그 기록

---

## Phase 3: 프로젝트 생성 및 자가진단 ✅ 완료

### 3.1 프로젝트 생성 (OPS_ADMIN)
- [x] 기업 기본 정보 입력 (회사명, 업종, 규모, 연락처 등)
- [x] 프로젝트 상태: NEW
- [x] 감사로그 기록

### 3.2 자가진단 입력 (OPS_ADMIN)
- [x] 30문항 응답 입력 폼
- [x] 점수화 (항목별/총점)
- [x] 요약 텍스트 자동/수동 생성
- [x] 프로젝트 상태: DIAGNOSED로 변경
- [x] 자가진단 수정 시 감사로그 기록
- [x] 수정 시 매칭 추천 재계산 가능 (기존 배정은 자동 변경 안함)

### 3.3 자가진단 템플릿 관리
- [x] 문항/차원/버전 관리 (OPS_ADMIN) - 기본 템플릿 포함
- [x] 템플릿 버전별 저장
- [x] 템플릿 관리 UI

---

## Phase 4: 매칭 추천 및 배정 ✅ 완료

### 4.1 매칭 추천 (Top-N)
- [x] 후보 필터: CONSULTANT_APPROVED + 상태 정상 (정지/비활성 제외)
- [x] 기업정보 + 자가진단 기반 매칭 알고리즘
- [x] 후보별 결과:
  - [x] 총점 (매칭 점수)
  - [x] 항목별 점수 구성
  - [x] 근거 (rationale)
- [x] 기본값 N=3
- [x] 프로젝트 상태: MATCH_RECOMMENDED로 변경

### 4.2 배정 (OPS_ADMIN)
- [x] 추천 후보 중 최종 배정 선택
- [x] 배정 사유 필수 입력
- [x] 프로젝트 상태: ASSIGNED로 변경
- [x] 배정 이력 저장 (project_assignments)
- [x] 감사로그 기록

### 4.3 배정 변경
- [x] 변경 사유 필수 입력
- [x] 이전 배정 이력 유지
- [x] 감사로그 기록 (변경 사유 포함)

---

## Phase 5: 인터뷰 입력 (컨설턴트) ✅ 완료

### 5.1 인터뷰 폼
- [x] 기업 세부 정보
- [x] 세부직무/세부업무 (N개)
- [x] AS-IS (현재 산출물/업무 흐름)
- [x] 병목/페인포인트 (우선순위 1~3)
- [x] 데이터/시스템 제약
- [x] 개선 목표 (KPI 후보) + 측정 방법
- [x] Before 수치 (선택)
- [x] 기업 요구사항

### 5.2 접근 권한
- [x] 배정된 프로젝트만 접근 가능 (RLS)
- [x] 자가진단 결과는 조회만 가능 (수정 불가)
- [x] 인터뷰 입력/수정 감사로그 기록
- [x] 프로젝트 상태: INTERVIEWED로 변경

---

## Phase 6: 로드맵 생성 및 버전관리 ✅ 완료

### 6.1 로드맵 생성
- [x] 입력 데이터 활용:
  - [x] 기업 정보 (OPS 입력)
  - [x] 자가진단 결과 (OPS 입력)
  - [x] 현장 인터뷰 (컨설턴트 입력)
  - [x] **배정 컨설턴트 프로필 스냅샷**
- [x] LLM 호출은 서버에서만 (키 노출 금지)
- [x] 생성 결과:
  - [x] NxM 로드맵 (행=세부직무/업무, 열=초/중/고급)
  - [x] 40시간 PBL 최적 과정 1개 (≤40h)
  - [x] 과정 상세 리스트
- [x] 각 과정 필수 포함:
  - [x] 과정명, 레벨, 대상 직무/업무, 교육대상
  - [x] 권장 시간 (≤40h)
  - [x] 커리큘럼, 실습/과제
  - [x] 사용 툴 (**무료 전제 표기**)
  - [x] 기대효과 + 측정방법
  - [x] 준비물/데이터/권한

### 6.2 무료 툴 정책 검증
- [x] 결과 JSON에 "무료 범위 표기" 누락 시 저장/FINAL 불가
- [x] '구독 필요/유료 좌석/결제 필요' 키워드 검출 → 경고 및 재생성 유도
- [x] 무료 정책 위반 시 FINAL 확정 금지

### 6.3 40시간 상한 검증
- [x] 각 과정 권장시간 ≤ 40h 검증
- [x] PBL 최적 과정 1개 합계 ≤ 40h 검증
- [x] 초과 시 저장/FINAL 불가

### 6.4 버전관리
- [x] 초안: DRAFT (무한 생성 가능)
- [x] FINAL: 1개만 유지
- [x] 새 FINAL 확정 시 기존 FINAL → ARCHIVED
- [x] 덮어쓰기 금지 (항상 새 버전 생성)
- [x] 프로젝트 상태: ROADMAP_DRAFTED → FINALIZED

### 6.5 수정 요청 (Revision Prompt)
- [x] 수정 요청 입력 → 새 버전 생성
- [x] 수정 요청 로그 저장
- [x] 수동 편집 (셀/과정) + 검증 (무료/40h)

### 6.6 컨설턴트 프로필 스냅샷
- [x] 로드맵 버전 생성 시점의 프로필 스냅샷 저장
- [x] 버전 재현성 보장

---

## Phase 7: PDF/XLSX 내보내기 ✅ 완료

### 7.1 다운로드
- [x] PDF (전체 로드맵) - jsPDF + jspdf-autotable
- [x] XLSX (표/상세) - xlsx (SheetJS)
- [x] **LLM 재호출 금지** - DB 저장 결과로 렌더링

### 7.2 스토리지 정책
- [x] 최신 FINAL만 스토리지에 저장 (XLSX)
- [x] 새 FINAL 확정 시 기존 FINAL 파일 삭제
- [x] DRAFT/ARCHIVED는 즉시 생성 (스토리지 미저장)

---

## Phase 8: 감사로그/쿼터/관리자 ✅ 완료

### 8.1 감사로그
- [x] 필수 이벤트 기록:
  - [x] 사용자 승인/정지
  - [x] 프로젝트 생성/수정
  - [x] 자가진단 입력/수정
  - [x] 매칭 실행/배정/변경 (사유 포함)
  - [x] 로드맵 생성/수정/FINAL/ARCHIVE
  - [x] 다운로드 (PDF/XLSX)
- [x] 필터/검색 기능 (액션, 대상, 날짜 필터)
- [x] 다운로드 기능 (CSV/Excel)

### 8.2 쿼터
- [x] DB 테이블 생성 (usage_metrics, user_quotas)
- [x] LLM 호출에만 쿼터 차감
- [x] 일/월 단위 상한
- [x] KST 기준 리셋
- [x] 사용자별 상한 조정 (OPS_ADMIN)
- [x] 초과 시 차단 + 안내 문구

### 8.3 관리자 대시보드
- [x] 사용량 통계
- [x] 쿼터 현황
- [x] 감사로그 조회

---

## Phase 9: UI/UX 및 반응형 ✅ 완료

### 9.1 PUBLIC 화면
- [x] 랜딩/소개
- [x] 샘플(데모) - 정적 화면 (LLM 호출 없음) - `/demo`
- [x] 로그인/회원가입

### 9.2 컨설턴트 화면
- [x] 배정된 프로젝트 목록
- [x] 프로젝트 상세 (기업정보/자가진단 읽기)
- [x] 인터뷰 입력/수정
- [x] 로드맵 생성/버전 히스토리
- [x] 결과 화면 (NxM + PBL + 상세)
- [x] 수정 요청 + 수동 편집
- [x] FINAL 확정 + 다운로드

### 9.3 OPS_ADMIN 화면
- [x] 사용자 승인/정지
- [x] 프로젝트 관리 (생성/자가진단/매칭/배정)
- [x] 자가진단 템플릿 관리
- [x] 감사로그/사용량/쿼터 대시보드
- [x] 로드맵 열람 (읽기 전용)

### 9.4 반응형 (모바일)
- [x] NxM 로드맵:
  - 데스크톱: 테이블
  - 모바일: 레벨 탭(초/중/고급) → 행 리스트 카드
- [x] 입력 폼: 단계형(섹션 분리) UI + 자동 저장
- [x] 결과 화면: 모바일 완전 동작

---

## Phase 10: 보안/품질/문서 ✅ 완료

### 10.1 보안
- [x] RLS 모든 테이블 적용
- [x] 서버 라우트에서 세션/role 검증
- [x] 민감정보 로그 금지
- [x] LLM API 키 노출 금지 (서버에서만 호출)

### 10.2 품질
- [x] 모든 폼 zod 스키마 검증
- [x] 서버에서도 재검증
- [x] ESLint + Prettier 통과
- [x] 타입체크 통과
- [x] 단위/통합 테스트 (최소) - 77개 테스트 (스키마 검증)

### 10.3 문서
- [x] `README.md` 완성
- [x] `docs/ARCHITECTURE.md`
- [x] `docs/RLS.md`
- [x] `docs/DECISIONS.md`

---

## 검증 체크리스트 (최종)

- [x] OPS_ADMIN이 기업정보+자가진단 입력하여 프로젝트 생성 가능
- [x] 자가진단+기업정보 기반 매칭 Top-N 제시 + 배정/변경(사유 기록) 가능
- [x] 승인 컨설턴트는 배정된 프로젝트만 접근 가능 (RLS)
- [x] 자가진단 조회 + 인터뷰 입력 가능 (컨설턴트)
- [x] NxM 로드맵 생성 (직무-업무-산출물-개선효과-측정방법-무료툴-시간≤40h)
- [x] 40시간 PBL 최적 과정 1개 (≤40h) 자동 선정
- [x] 수정 요청으로 버전 누적 (FINAL 덮어쓰기 금지)
- [x] FINAL 1개만 유지
- [x] PDF/XLSX 다운로드 (LLM 재호출 금지)
- [x] 스토리지에 최신 FINAL만 저장
- [x] 감사로그/사용량/쿼터 정상 동작
- [x] 반응형 정상 동작 (데스크톱/태블릿/모바일)

---

## 현재 진행 상태 요약

| Phase | 상태 | 설명 |
|-------|------|------|
| Phase 1 | ✅ 완료 | 인프라, DB 스키마, RLS |
| Phase 2 | ✅ 완료 | 인증/승인 플로우 |
| Phase 3 | ✅ 완료 | 프로젝트 생성, 자가진단 |
| Phase 4 | ✅ 완료 | 매칭 추천, 배정 |
| Phase 5 | ✅ 완료 | 인터뷰 입력 |
| Phase 6 | ✅ 완료 | 로드맵 생성/버전관리 |
| Phase 7 | ✅ 완료 | PDF/XLSX 내보내기 |
| Phase 8 | ✅ 완료 | 감사로그/쿼터 관리 |
| Phase 9 | ✅ 완료 | OPS/컨설턴트 화면 완료 |
| Phase 10 | ✅ 완료 | 보안/품질/문서 완료 |

**모든 Phase 완료!**
